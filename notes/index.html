<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>数学知识笔记 - PigAunt 的博客</title><meta name=Description content="数学知识笔记"><meta property="og:title" content="数学知识笔记"><meta property="og:description" content="数学知识笔记"><meta property="og:type" content="article"><meta property="og:url" content="https://www.pigaunt.top/notes/"><meta property="og:image" content="https://www.pigaunt.top/images/favicon-32x32.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-20T19:51:52+08:00"><meta property="article:modified_time" content="2022-07-23T08:26:38+08:00"><meta property="og:site_name" content="PigAunt 的博客"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.pigaunt.top/images/favicon-32x32.png"><meta name=twitter:title content="数学知识笔记"><meta name=twitter:description content="数学知识笔记"><meta name=application-name content="PigAunt 的博客"><meta name=apple-mobile-web-app-title content="PigAunt 的博客"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=canonical href=https://www.pigaunt.top/notes/><link rel=prev href=https://www.pigaunt.top/matrix/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"数学知识笔记","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.pigaunt.top\/notes\/"},"genre":"posts","keywords":"数学","wordcount":4071,"url":"https:\/\/www.pigaunt.top\/notes\/","datePublished":"2022-07-20T19:51:52+08:00","dateModified":"2022-07-23T08:26:38+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"PigAunt"},"description":"数学知识笔记"}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="PigAunt 的博客"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/favicon.ico data-srcset="/images/favicon.ico, /images/favicon.ico 1.5x, /images/favicon.ico 2x" data-sizes=auto alt=/images/favicon.ico title=/images/favicon.ico></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop><input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="PigAunt 的博客"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/favicon.ico data-srcset="/images/favicon.ico, /images/favicon.ico 1.5x, /images/favicon.ico 2x" data-sizes=auto alt=/images/favicon.ico title=/images/favicon.ico></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">数学知识笔记</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://www.pigaunt.top title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>PigAunt</a></span>&nbsp;<span class=post-category>included in <a href=/categories/%E6%95%B0%E5%AD%A6/><i class="far fa-folder fa-fw" aria-hidden=true></i>数学</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-07-20>2022-07-20</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;4071 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;9 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#exgcd>ExGCD</a></li><li><a href=#crt>CRT</a><ul><li><a href=#excrt>ExCRT</a></li></ul></li><li><a href=#bsgs>BSGS</a><ul><li><a href=#exbsgs>ExBSGS</a></li><li><a href=#特殊的-bsgs>特殊的 BSGS</a></li></ul></li><li><a href=#原根和阶>原根和阶</a><ul><li><a href=#阶-order>阶 (order)</a></li><li><a href=#原根>原根</a></li></ul></li><li><a href=#筛法>筛法</a><ul><li><a href=#线性筛筛积性函数>线性筛筛积性函数</a></li><li><a href=#杜教筛>杜教筛</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>最近学到的数学知识笔记，如有谬误欢迎指正 :yum:。</p><h2 id=exgcd>ExGCD</h2><p>用于解不定方程 $ax + by = \gcd(a, b)$ 的一组整数解。</p><p>当 $b = 0$ 时，有一组解 $x = 1, y = 0$；我们研究能不能通过 $b, a \bmod b$ 的一组解得到 $a, b$ 的一组解，因为如果能，那么我们可以在辗转相除的过程中推出 $x, y$。</p><p>由于</p><data id=id-1 data-raw></data><p>因此</p><data id=id-2 data-raw></data><p>得到</p><data id=id-3 data-raw></data><p>我们在辗转相除的递归过程中不断修改 $x, y$，最后得到要求的一组特解。</p><p>参考代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-cpp data-lang=cpp><span class=kt>int</span> <span class=nf>ExGcd</span><span class=p>(</span><span class=kt>int</span> <span class=n>a</span><span class=p>,</span> <span class=kt>int</span> <span class=n>b</span><span class=p>,</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>x</span><span class=p>,</span> <span class=kt>int</span> <span class=o>&amp;</span><span class=n>y</span><span class=p>)</span>
<span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>b</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>x</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
        <span class=k>return</span> <span class=n>a</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kt>int</span> <span class=n>d</span> <span class=o>=</span> <span class=n>ExGcd</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>a</span> <span class=o>%</span> <span class=n>b</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>x</span><span class=p>);</span>
    <span class=n>y</span> <span class=o>-=</span> <span class=n>a</span> <span class=o>/</span> <span class=n>b</span> <span class=o>*</span> <span class=n>x</span><span class=p>;</span>
    <span class=k>return</span> <span class=n>d</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>现在将问题扩展为求 $ax + by = c$ 的一组特解，根据 Bézout 定理，方程有解的充要条件是 $\gcd(a, b) \mid c$。如果有解，求出 $ax + bx = \gcd(a, b)$ 的一组特解，然后 $x, y$ 同时乘 $\frac {c} {\gcd(a, b)}$ 即可。</p><h2 id=crt>CRT</h2><p>用于解形式如下的线性同余方程组：</p><data id=id-4 data-raw></data><p>其中 $p$ 两两互质。</p><p>对于这样一个方程组，我们可以按如下流程构造出一个特解：</p><ol><li>令 $P = \prod p_i$；</li><li>由于 $p$ 两两互质，我们可以求出 $\frac {P} {p_i}$ 在模 $p_i$ 意义下的逆元 $inv_i$；</li><li>令 $x_i = \frac {P} {p_i} \times inv_i$；</li><li>$x = \sum a_i x_i$。</li></ol><p>这个构造是正确的，因为：</p><data id=id-5 data-raw></data><p>$x_i$ 乘上 $a_i$， $x$ 是满足所有方程的一个特解。</p><p>现在要得到一个通解，$x$ 加上 $k$ 倍的 $\mathrm{lcm}(p_1, p_2, \dots, p_n)$ 即可，而 $p$ 两两互质，所以加上 $k$ 倍的 $P$ 就行了。</p><h3 id=excrt>ExCRT</h3><p>问题升级为不要求模数两两互质，也就是不一定有逆元了，因此我们采用将线性同余方程不断合并的方式，最后得到一个线性同余方程，用 ExGCD 求解（与 CRT 采用的构造法完全不同）。</p><p>将两个线性同余方程合并：</p><data id=id-6 data-raw></data><p>令 $x = k_1 p_1 + a_1 = k_2 p_2 + a_2$，得到 $k_2 p_2 - k_1 p_1 = a_1 - a_2$，这个方程符合 $ax + by = c$ 的形式，可以用 ExGCD 求解。得到 $k_1, k_2$ 后，随便代入一个方程，比如第一个，得到 $x = k_1 p_1 + a_1$，那么：</p><data id=id-7 data-raw></data><p>取模数为 $\mathrm{lcm}(p_1, p_2)$ 的目的同样是把 $x$ 的特解转换成一个通解的形式，并保证余数不变。</p><p>不断重复合并的过程，最终得到一个线性同余方程：</p><data id=id-8 data-raw></data><p>时间复杂度 $\mathrm{O}(n \log_2 p)$。</p><h2 id=bsgs>BSGS</h2><p>用于解高次同余方程 $a^x \equiv b \pmod p$（离散对数问题），其中 $(a, p) = 1$。</p><p>我们令 $m = \sqrt p$，并令 $x = im - j$（用减法是为了后面不出现负号），那么原方程就变成了：</p><data id=id-9 data-raw></data><p>由于 $(a, p) = 1$，$a$ 存在模 $p$ 意义下的逆元，因此我们可以把 $a^{im - j}$ 拆了，并在两边同时乘 $a^j$，得到：</p><data id=id-10 data-raw></data><p>现在我们就避免了同时枚举两个数。分别枚举 $i, j$，一次枚举时将得到的值存表，另一次查表，就能得到满足条件的解。</p><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw" aria-hidden=true></i>求最小 / 最大解的方法<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>调整枚举顺序：</p><ol><li>求最小解：先从小到大枚举 $j$（即存表时如果冲突，保留 $j$ 更大的），再从小到大枚举 $i$，找到就退出；</li><li>求最大解：先从大到小枚举 $j$（即存表时如果冲突，保留 $j$ 更小的），再从大到小枚举 $i$，找到就退出。</li></ol></div></div></div><p>时间复杂度取决于表的实现，如果使用哈希表，则时间复杂度 $\mathrm{O}(\sqrt p)$，如果使用平衡树（<code>std::map</code>），则时间复杂度 $\mathrm{O}(\sqrt p \log_2 p)$</p><p>参考代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-cpp data-lang=cpp><span class=kt>int</span> <span class=nf>BSGS</span><span class=p>(</span><span class=kt>int</span> <span class=n>a</span><span class=p>,</span> <span class=kt>int</span> <span class=n>b</span><span class=p>,</span> <span class=kt>int</span> <span class=n>p</span><span class=p>)</span>
<span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=mi>1</span> <span class=o>%</span> <span class=n>p</span> <span class=o>==</span> <span class=n>b</span> <span class=o>%</span> <span class=n>p</span><span class=p>)</span>
        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
    <span class=kt>int</span> <span class=n>k</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>sqrt</span><span class=p>(</span><span class=n>p</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
    <span class=n>std</span><span class=o>::</span><span class=n>map</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span> <span class=n>hash</span><span class=p>;</span>
    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>j</span> <span class=o>=</span> <span class=n>b</span> <span class=o>%</span> <span class=n>p</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>k</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>hash</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>
        <span class=n>j</span> <span class=o>=</span> <span class=p>(</span><span class=kt>long</span> <span class=kt>long</span><span class=p>)</span><span class=n>j</span> <span class=o>*</span> <span class=n>a</span> <span class=o>%</span> <span class=n>p</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kt>int</span> <span class=n>ak</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>k</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
        <span class=n>ak</span> <span class=o>=</span> <span class=p>(</span><span class=kt>long</span> <span class=kt>long</span><span class=p>)</span><span class=n>ak</span> <span class=o>*</span> <span class=n>a</span> <span class=o>%</span> <span class=n>p</span><span class=p>;</span>
    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span> <span class=n>j</span> <span class=o>=</span> <span class=n>ak</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>k</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>hash</span><span class=p>.</span><span class=n>count</span><span class=p>(</span><span class=n>j</span><span class=p>))</span>
            <span class=k>return</span> <span class=p>(</span><span class=kt>long</span> <span class=kt>long</span><span class=p>)</span><span class=n>i</span> <span class=o>*</span> <span class=n>k</span> <span class=o>-</span> <span class=n>hash</span><span class=p>[</span><span class=n>j</span><span class=p>];</span>
        <span class=n>j</span> <span class=o>=</span> <span class=p>(</span><span class=kt>long</span> <span class=kt>long</span><span class=p>)</span><span class=n>j</span> <span class=o>*</span> <span class=n>ak</span> <span class=o>%</span> <span class=n>p</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=o>-</span><span class=n>PosInf</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><h3 id=exbsgs>ExBSGS</h3><p>问题升级为不保证 $(a, p) = 1$，因此 $a$ 不一定存在模 $p$ 意义下的逆元。</p><p>为了解决这个问题，我们取 $d = \gcd(a, p)$。如果 $d = 1$，则套用 BSGS 算法求解；否则在同余方程中将 $d$ 消去（如果 $d \nmid b$，则无解），即：</p><data id=id-11 data-raw></data><p>再求 $d = \gcd(a, \frac p d)$，重复上述过程，直至 $d = 1$，即我们最终做 BSGS 的高次同余方程是：</p><data id=id-12 data-raw></data><p>但要注意，现在我们默认 $x \ge k$ 了，但有可能 $x &lt; k$ 的时候有解。对于这个范围的 $x$，我们直接枚举求解（代入原方程），因为 $k$ 较小，因此并不会降低效率。</p><p>参考代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-cpp data-lang=cpp><span class=kt>int</span> <span class=nf>ExBSGS</span><span class=p>(</span><span class=kt>int</span> <span class=n>a</span><span class=p>,</span> <span class=kt>int</span> <span class=n>b</span><span class=p>,</span> <span class=kt>int</span> <span class=n>p</span><span class=p>)</span>
<span class=p>{</span>
    <span class=n>b</span> <span class=o>=</span> <span class=p>(</span><span class=n>b</span> <span class=o>%</span> <span class=n>p</span> <span class=o>+</span> <span class=n>p</span><span class=p>)</span> <span class=o>%</span> <span class=n>p</span><span class=p>;</span>
    <span class=k>if</span> <span class=p>(</span><span class=mi>1</span> <span class=o>%</span> <span class=n>p</span> <span class=o>==</span> <span class=n>b</span> <span class=o>%</span> <span class=n>p</span><span class=p>)</span>
        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
    <span class=kt>int</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>d</span> <span class=o>=</span> <span class=n>ExGcd</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>d</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>b</span> <span class=o>%</span> <span class=n>d</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span>
            <span class=k>return</span> <span class=o>-</span><span class=n>PosInf</span><span class=p>;</span>
        <span class=n>ExGcd</span><span class=p>(</span><span class=n>a</span> <span class=o>/</span> <span class=n>d</span><span class=p>,</span> <span class=n>p</span> <span class=o>/</span> <span class=n>d</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>);</span>
        <span class=k>return</span> <span class=n>ExBSGS</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=p>(</span><span class=kt>long</span> <span class=kt>long</span><span class=p>)</span><span class=n>b</span> <span class=o>/</span> <span class=n>d</span> <span class=o>*</span> <span class=n>x</span> <span class=o>%</span> <span class=p>(</span><span class=n>p</span> <span class=o>/</span> <span class=n>d</span><span class=p>),</span> <span class=n>p</span> <span class=o>/</span> <span class=n>d</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=n>BSGS</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><h3 id=特殊的-bsgs>特殊的 BSGS</h3><p>BSGS 还可以用来求解其它类型的简单高次方程，这里以矩阵为例：</p><data id=id-13 data-raw></data><p>只要矩阵 $A$ 有逆元（$A \times A^{-1} = I$），我们可以完全套用 BSGS 的做法，只是将数改为矩阵（包括表中存储的内容）。</p><p>上述算法的一个应用是求 Fibonacci 数列在模 $p$ 意义下的最小循环节 $x$，即解这个方程：</p><data id=id-14 data-raw></data><p>令 $A = \begin{bmatrix} 0 & 1 \cr 1 & 1 \end{bmatrix}$，我们发现 $A$ 存在逆元 $\begin{bmatrix} -1 & 1 \cr 1 & 0 \end{bmatrix}$，可以通过上述方法求解，即代入做 BSGS 求最小解即得到最小循环节。</p><h2 id=原根和阶>原根和阶</h2><h3 id=阶-order>阶 (order)</h3><p>对于一个数 $a$ 和模数 $p$，我们称最小的满足下面条件的数 $k$ 是 $a$ 模 $p$ 的阶：$a^k \equiv 1 \pmod p$，写作 $\mathrm{ord}(a) = k$。</p><p>阶有一个性质：$\mathrm{ord}(a) \mid \varphi(a)$，因为 $\mathrm{ord}(a)$ 整除任意满足 $a^x \equiv 1 \pmod p$ 的数 $x$（可以利用 $x = k \times \mathrm{ord}(a) + r$ 证明出 $r = 0$），那么要求 $a$ 的阶就可以枚举 $\varphi(a)$ 的因数。</p><h3 id=原根>原根</h3><p>对于一个数 $p$，我们称一个满足下面条件的数 $g$ 是它的原根：$g^1, g^2, \dots, g^{\varphi(p)}$ 互不相同，且是 $1$ 到 $p - 1$ 中与 $p$ 互质的数的一个排列。</p><p>例如，$3$ 是 $998244353$ 的一个原根。</p><p>结合上面阶的定义，$p$ 的原根的阶是 $\varphi(p)$，且阶为 $\varphi(p)$ 的数是 $p$ 的原根。因此要判断一个数是不是原根，我们可以验证它的阶是不是 $\varphi(p)$，但此时可以只枚举 $\frac {\varphi(p)} {x}$（$x$ 是 $p$ 的质因子，暂不能证明）。</p><p>经数学家证明，一个数如果存在原根，其最小原根是较小的，因此可以用枚举找原根。</p><h2 id=筛法>筛法</h2><p>如果要找一个范围内的质数，我们采用枚举每一个数并验证的方法是不好的，因为时间复杂度太高；但如果反过来，我们把不满足条件的删掉，就可以大大加速求解过程。</p><p>从 $2$ 开始枚举。当我们枚举到一个没有被标记的数时，我们确定它是一个质数；确定完一个数是不是质数后，我们标记它的倍数，流程如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-cpp data-lang=cpp><span class=kt>int</span> <span class=n>primes</span><span class=p>[</span><span class=n>N</span><span class=p>],</span> <span class=n>total</span><span class=p>;</span>
<span class=kt>bool</span> <span class=n>del</span><span class=p>[</span><span class=n>N</span><span class=p>];</span>

<span class=kt>void</span> <span class=nf>GetPrimes</span><span class=p>(</span><span class=kt>int</span> <span class=n>maxVal</span><span class=p>)</span>
<span class=p>{</span>
    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>maxVal</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>del</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
            <span class=n>primes</span><span class=p>[</span><span class=o>++</span><span class=n>total</span><span class=p>]</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>
        
        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>*</span> <span class=n>primes</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=n>maxVal</span> <span class=o>&amp;&amp;</span> <span class=n>j</span> <span class=o>&lt;=</span> <span class=n>total</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span>
            <span class=n>del</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=n>primes</span><span class=p>[</span><span class=n>j</span><span class=p>]]</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>上面的过程叫 Eratosthenes 筛法，时间复杂度 $\mathrm{O}(n \log_2 \log_2 n)$。我们发现时间复杂度的瓶颈在于一个数会被多个数标记，但我们希望一个数只被筛一次，因此我们规定：一个数只被它的最小质因子筛掉，于是有了下面的流程：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-cpp data-lang=cpp><span class=kt>int</span> <span class=n>primes</span><span class=p>[</span><span class=n>N</span><span class=p>],</span> <span class=n>total</span><span class=p>;</span>
<span class=kt>bool</span> <span class=n>del</span><span class=p>[</span><span class=n>N</span><span class=p>];</span>

<span class=kt>void</span> <span class=nf>GetPrimes</span><span class=p>(</span><span class=kt>int</span> <span class=n>maxVal</span><span class=p>)</span>
<span class=p>{</span>
    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>maxVal</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>del</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
            <span class=n>primes</span><span class=p>[</span><span class=o>++</span><span class=n>total</span><span class=p>]</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>
        
        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>*</span> <span class=n>primes</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=n>maxVal</span> <span class=o>&amp;&amp;</span> <span class=n>j</span> <span class=o>&lt;=</span> <span class=n>total</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=n>del</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=n>primes</span><span class=p>[</span><span class=n>j</span><span class=p>]]</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>i</span> <span class=o>%</span> <span class=n>primes</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
                <span class=k>break</span><span class=p>;</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>增加的两行代码完成了这样一个事情：枚举 $\mathrm{primes}_j$ 就是在枚举最小质因子，一旦发现 $i$ 中包含了 $i \times \mathrm{primes}_j$ 的最小质因子 $\mathrm{primes}_j$，那么说明后面的数中 $\mathrm{primes}_j$ 不再是它们的最小质因子，因此直接退出。可以证明这样会不重不漏地筛掉所有合数（我证不来，欢迎指教）。这个过程叫线性筛，时间复杂度 $\mathrm{O}(n)$。</p><h3 id=线性筛筛积性函数>线性筛筛积性函数</h3><p>由于积性函数 $f$ 满足 $\forall \gcd(x, y) = 1, f(xy) = f(x) f(y)$，那么对于一个数 $n = \prod p_i^{c_i}$，我们只需要知道每一个 $p_i^{c_i}$ 的函数值，就能得到 $n$ 的函数值，因此我们对线性筛的过程进行扩充，记录 $g_i$ 表示 $i$ 的最小质因子对应的幂（即 $p_1^{c_1}$），然后分类讨论求 $g_i$：</p><ol><li>如果 $i$ 是质数，那么 $g_i = i$；</li><li>如果 $\mathrm{primes}_j \mid i$，说明应当累计 <data id=id-15 data-raw></data>的最小质因子，那么 <data id=id-16 data-raw></data>；</li><li>如果 $\mathrm{primes}_j \nmid i$，说明枚举到了 <data id=id-17 data-raw></data>的最小质因子，那么 <data id=id-18 data-raw></data>。</li></ol><p>现在得到了 $g_i$，那么求 $f(i)$ 的过程也可以分类讨论：</p><ol><li>如果 $g_i = i$，说明 $i$ 是质数，按 $f$ 的定义直接求（数论函数一般在质数上的函数值都很好求，因为因子只有 $1$ 和自己）；</li><li>如果 $\mathrm{primes}_j \nmid i$，那么它们互质，可以根据积性函数的性质，$f(i \times \mathrm{primes}_j) = f(i) \times f(\mathrm{primes}_j)$；</li><li>如果 $\mathrm{primes}_j \mid i$，我们继续讨论：<ol><li>如果 $g_i = i$，那么这是两个质数相乘的情况，直接求；</li><li>否则说明是往 $i$ 上累加一个质数 $\mathrm{primes}_j$，我们调整成两个质数的函数值相乘的情况，即 $f(i \times \mathrm{primes}_j) = f(\frac {i} {g_i}) \times f(g_i \times \mathrm{primes}_j)$。</li></ol></li></ol><p>现在我们以 $f = \mu * \mathrm{id}_k$ 的求值为例，参考代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-cpp data-lang=cpp><span class=kt>int</span> <span class=n>f</span><span class=p>[</span><span class=n>N</span> <span class=o>+</span> <span class=mi>5</span><span class=p>],</span> <span class=n>g</span><span class=p>[</span><span class=n>N</span> <span class=o>+</span> <span class=mi>5</span><span class=p>];</span>
<span class=kt>int</span> <span class=n>primes</span><span class=p>[</span><span class=n>N</span> <span class=o>+</span> <span class=mi>5</span><span class=p>],</span> <span class=n>total</span><span class=p>;</span>

<span class=kt>void</span> <span class=nf>GetPrimes</span><span class=p>(</span><span class=kt>int</span> <span class=n>maxVal</span><span class=p>)</span>
<span class=p>{</span>
    <span class=n>f</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>g</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>maxVal</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=n>primes</span><span class=p>[</span><span class=o>++</span><span class=n>total</span><span class=p>]</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>
            <span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>FastPow</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>K</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span>
            <span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>
        <span class=p>}</span>

        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>*</span> <span class=n>primes</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=n>maxVal</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>i</span> <span class=o>%</span> <span class=n>primes</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
            <span class=p>{</span>
                <span class=k>if</span> <span class=p>(</span><span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=n>i</span><span class=p>)</span> <span class=c1>// p^{nk} * (p^k - 1).
</span><span class=c1></span>                    <span class=n>f</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=n>primes</span><span class=p>[</span><span class=n>j</span><span class=p>]]</span> <span class=o>=</span> <span class=p>(</span><span class=kt>long</span> <span class=kt>long</span><span class=p>)</span><span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>*</span> <span class=p>(</span><span class=n>f</span><span class=p>[</span><span class=n>primes</span><span class=p>[</span><span class=n>j</span><span class=p>]]</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>%</span> <span class=n>MOD</span><span class=p>;</span>
                <span class=k>else</span>
                    <span class=n>f</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=n>primes</span><span class=p>[</span><span class=n>j</span><span class=p>]]</span> <span class=o>=</span> <span class=p>(</span><span class=kt>long</span> <span class=kt>long</span><span class=p>)</span><span class=n>f</span><span class=p>[</span><span class=n>i</span> <span class=o>/</span> <span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>]]</span> <span class=o>*</span> <span class=n>f</span><span class=p>[</span><span class=n>primes</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>*</span> <span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>]]</span> <span class=o>%</span> <span class=n>MOD</span><span class=p>;</span>
                <span class=n>g</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=n>primes</span><span class=p>[</span><span class=n>j</span><span class=p>]]</span> <span class=o>=</span> <span class=n>g</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>*</span> <span class=n>primes</span><span class=p>[</span><span class=n>j</span><span class=p>];</span>
                <span class=k>break</span><span class=p>;</span>
            <span class=p>}</span>

            <span class=n>f</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=n>primes</span><span class=p>[</span><span class=n>j</span><span class=p>]]</span> <span class=o>=</span> <span class=p>(</span><span class=kt>long</span> <span class=kt>long</span><span class=p>)</span><span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>*</span> <span class=n>f</span><span class=p>[</span><span class=n>primes</span><span class=p>[</span><span class=n>j</span><span class=p>]]</span> <span class=o>%</span> <span class=n>MOD</span><span class=p>;</span>
            <span class=n>g</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=n>primes</span><span class=p>[</span><span class=n>j</span><span class=p>]]</span> <span class=o>=</span> <span class=n>primes</span><span class=p>[</span><span class=n>j</span><span class=p>];</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>对于一些特殊的积性函数（如 $\varphi$，$\mu$），我们不必这么麻烦，可以利用它自己的特殊性质，修改线性筛的过程求值。</p><h3 id=杜教筛>杜教筛</h3><p>有时我们不需要得到积性函数的值，而是它的前缀和，在线性筛 $\mathrm{O}(n)$ 的基础上，杜教筛可以在 $\mathrm{O}(n^{\frac 2 3})$ 的时间内求得积性函数的前缀和。</p><p>令 $s(n) = \sum_{i = 1}^n f(i)$，若 $f * g = h$，那么：</p><data id=id-19 data-raw></data><p>移项后得到：</p><data id=id-20 data-raw></data><p>如果 $g, h$ 的前缀和很好算，那么 $s(n)$ 就好求了。常见的 $f * g = h$ 有 $\mu * \mathrm{I} = \epsilon$，$\varphi * \mathrm{I} = \mathrm{id}$，$\mathrm{id} * \mu = \varphi$（$\mathrm{I}, \mathrm{id}$ 的前缀和都很好算）。</p><p>具体流程：先线性筛预处理 $f$ 的前 $\mathrm{O}(n^{\frac 2 3})$ 项，再递归实现上述过程，并用一个表存储 $s$ 的值。</p><p>下面以求 $\mu, \varphi$ 的前缀和为例（<a href=https://www.luogu.com.cn/problem/P4213 target=_blank rel="noopener noreffer ">洛谷 P4213 【模板】杜教筛（Sum）</a>），参考代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span><span class=lnt>94
</span><span class=lnt>95
</span><span class=lnt>96
</span><span class=lnt>97
</span><span class=lnt>98
</span><span class=lnt>99
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-cpp data-lang=cpp><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span><span class=cp>#include</span> <span class=cpf>&lt;map&gt;</span><span class=cp>
</span><span class=cp></span>
<span class=k>const</span> <span class=kt>int</span> <span class=n>M</span> <span class=o>=</span> <span class=mf>1e6</span><span class=p>;</span>

<span class=k>struct</span> <span class=nc>Info</span>
<span class=p>{</span>
    <span class=kt>long</span> <span class=kt>long</span> <span class=n>mu</span><span class=p>,</span> <span class=n>phi</span><span class=p>;</span>
    <span class=n>Info</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=n>mu</span> <span class=o>=</span> <span class=n>phi</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=n>Info</span><span class=p>(</span><span class=kt>long</span> <span class=kt>long</span> <span class=n>_mu</span><span class=p>,</span> <span class=kt>long</span> <span class=kt>long</span> <span class=n>_phi</span><span class=p>)</span>
        <span class=o>:</span> <span class=n>mu</span><span class=p>(</span><span class=n>_mu</span><span class=p>),</span> <span class=n>phi</span><span class=p>(</span><span class=n>_phi</span><span class=p>)</span> <span class=p>{}</span>

    <span class=n>Info</span> <span class=k>operator</span><span class=o>+</span><span class=p>(</span><span class=k>const</span> <span class=n>Info</span> <span class=o>&amp;</span><span class=n>x</span><span class=p>)</span> <span class=k>const</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=p>{</span><span class=n>mu</span> <span class=o>+</span> <span class=n>x</span><span class=p>.</span><span class=n>mu</span><span class=p>,</span> <span class=n>phi</span> <span class=o>+</span> <span class=n>x</span><span class=p>.</span><span class=n>phi</span><span class=p>};</span>
    <span class=p>}</span>
    <span class=n>Info</span> <span class=k>operator</span><span class=o>-</span><span class=p>(</span><span class=k>const</span> <span class=n>Info</span> <span class=o>&amp;</span><span class=n>x</span><span class=p>)</span> <span class=k>const</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=p>{</span><span class=n>mu</span> <span class=o>-</span> <span class=n>x</span><span class=p>.</span><span class=n>mu</span><span class=p>,</span> <span class=n>phi</span> <span class=o>-</span> <span class=n>x</span><span class=p>.</span><span class=n>phi</span><span class=p>};</span>
    <span class=p>}</span>
    <span class=n>Info</span> <span class=k>operator</span><span class=o>*</span><span class=p>(</span><span class=k>const</span> <span class=kt>long</span> <span class=kt>long</span> <span class=n>x</span><span class=p>)</span> <span class=k>const</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=p>{</span><span class=n>mu</span> <span class=o>*</span> <span class=n>x</span><span class=p>,</span> <span class=n>phi</span> <span class=o>*</span> <span class=n>x</span><span class=p>};</span>
    <span class=p>}</span>
<span class=p>}</span> <span class=n>val</span><span class=p>[</span><span class=n>M</span> <span class=o>+</span> <span class=mi>5</span><span class=p>],</span> <span class=n>bSum</span><span class=p>[</span><span class=n>M</span> <span class=o>+</span> <span class=mi>5</span><span class=p>];</span>

<span class=kt>int</span> <span class=n>primes</span><span class=p>[</span><span class=n>M</span> <span class=o>+</span> <span class=mi>5</span><span class=p>],</span> <span class=n>total</span><span class=p>;</span>
<span class=kt>bool</span> <span class=n>del</span><span class=p>[</span><span class=n>M</span> <span class=o>+</span> <span class=mi>5</span><span class=p>];</span>
<span class=n>std</span><span class=o>::</span><span class=n>map</span><span class=o>&lt;</span><span class=kt>long</span> <span class=kt>long</span><span class=p>,</span> <span class=n>Info</span><span class=o>&gt;</span> <span class=n>sum</span><span class=p>;</span>

<span class=kt>void</span> <span class=nf>GetPrimes</span><span class=p>(</span><span class=kt>int</span> <span class=n>maxVal</span><span class=p>)</span>
<span class=p>{</span>
    <span class=n>val</span><span class=p>[</span><span class=mi>1</span><span class=p>].</span><span class=n>phi</span> <span class=o>=</span> <span class=n>val</span><span class=p>[</span><span class=mi>1</span><span class=p>].</span><span class=n>mu</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>maxVal</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>Info</span> <span class=o>&amp;</span><span class=n>u</span> <span class=o>=</span> <span class=n>val</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>del</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
        <span class=p>{</span>
            <span class=n>primes</span><span class=p>[</span><span class=o>++</span><span class=n>total</span><span class=p>]</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>
            <span class=n>u</span><span class=p>.</span><span class=n>mu</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
            <span class=n>u</span><span class=p>.</span><span class=n>phi</span> <span class=o>=</span> <span class=n>i</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span>
        <span class=p>}</span>

        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>*</span> <span class=n>primes</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=n>maxVal</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=n>del</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=n>primes</span><span class=p>[</span><span class=n>j</span><span class=p>]]</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
            <span class=n>Info</span> <span class=o>&amp;</span><span class=n>v</span> <span class=o>=</span> <span class=n>val</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=n>primes</span><span class=p>[</span><span class=n>j</span><span class=p>]];</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>i</span> <span class=o>%</span> <span class=n>primes</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
            <span class=p>{</span>
                <span class=n>v</span><span class=p>.</span><span class=n>phi</span> <span class=o>=</span> <span class=n>u</span><span class=p>.</span><span class=n>phi</span> <span class=o>*</span> <span class=n>primes</span><span class=p>[</span><span class=n>j</span><span class=p>];</span>
                <span class=n>v</span><span class=p>.</span><span class=n>mu</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
                <span class=k>break</span><span class=p>;</span>
            <span class=p>}</span>
            <span class=n>v</span><span class=p>.</span><span class=n>phi</span> <span class=o>=</span> <span class=n>u</span><span class=p>.</span><span class=n>phi</span> <span class=o>*</span> <span class=p>(</span><span class=n>primes</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>);</span>
            <span class=n>v</span><span class=p>.</span><span class=n>mu</span> <span class=o>=</span> <span class=o>-</span><span class=n>u</span><span class=p>.</span><span class=n>mu</span><span class=p>;</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=n>bSum</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>val</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>maxVal</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
        <span class=n>bSum</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>bSum</span><span class=p>[</span><span class=n>i</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=n>val</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
<span class=p>}</span>

<span class=n>Info</span> <span class=nf>GetSum</span><span class=p>(</span><span class=kt>long</span> <span class=kt>long</span> <span class=n>x</span><span class=p>)</span>
<span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>x</span> <span class=o>&lt;=</span> <span class=n>M</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>bSum</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>sum</span><span class=p>.</span><span class=n>count</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>sum</span><span class=p>[</span><span class=n>x</span><span class=p>];</span>
    
    <span class=n>Info</span> <span class=n>res</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
    <span class=n>res</span><span class=p>.</span><span class=n>mu</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span> <span class=n>res</span><span class=p>.</span><span class=n>phi</span> <span class=o>=</span> <span class=p>(</span><span class=kt>long</span> <span class=kt>long</span><span class=p>)</span><span class=n>x</span> <span class=o>*</span> <span class=p>(</span><span class=n>x</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>;</span>
    <span class=k>for</span> <span class=p>(</span><span class=kt>long</span> <span class=kt>long</span> <span class=n>l</span> <span class=o>=</span> <span class=mi>2</span><span class=p>,</span> <span class=n>r</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>l</span> <span class=o>&lt;=</span> <span class=n>x</span> <span class=o>&amp;&amp;</span> <span class=n>r</span> <span class=o>&lt;=</span> <span class=n>x</span><span class=p>;</span> <span class=n>l</span> <span class=o>=</span> <span class=n>r</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>r</span> <span class=o>=</span> <span class=n>x</span> <span class=o>/</span> <span class=p>(</span><span class=n>x</span> <span class=o>/</span> <span class=n>l</span><span class=p>);</span>
        <span class=n>res</span> <span class=o>=</span> <span class=n>res</span> <span class=o>-</span> <span class=n>GetSum</span><span class=p>(</span><span class=n>x</span> <span class=o>/</span> <span class=n>l</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=n>r</span> <span class=o>-</span> <span class=n>l</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=n>sum</span><span class=p>[</span><span class=n>x</span><span class=p>]</span> <span class=o>=</span> <span class=n>res</span><span class=p>;</span>
    <span class=k>return</span> <span class=n>res</span><span class=p>;</span>
<span class=p>}</span>

<span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
<span class=p>{</span>
    <span class=n>std</span><span class=o>::</span><span class=n>ios</span><span class=o>::</span><span class=n>sync_with_stdio</span><span class=p>(</span><span class=nb>false</span><span class=p>);</span>

    <span class=kt>int</span> <span class=n>T</span><span class=p>,</span> <span class=n>n</span><span class=p>;</span>
    <span class=n>std</span><span class=o>::</span><span class=n>cin</span> <span class=o>&gt;&gt;</span> <span class=n>T</span><span class=p>;</span>
    <span class=n>GetPrimes</span><span class=p>(</span><span class=n>M</span><span class=p>);</span>
    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>test</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>test</span> <span class=o>&lt;=</span> <span class=n>T</span><span class=p>;</span> <span class=n>test</span><span class=o>++</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>std</span><span class=o>::</span><span class=n>cin</span> <span class=o>&gt;&gt;</span> <span class=n>n</span><span class=p>;</span>
        <span class=n>Info</span> <span class=n>res</span> <span class=o>=</span> <span class=n>GetSum</span><span class=p>(</span><span class=n>n</span><span class=p>);</span>
        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>res</span><span class=p>.</span><span class=n>phi</span> <span class=o>&lt;&lt;</span> <span class=sc>&#39; &#39;</span> <span class=o>&lt;&lt;</span> <span class=n>res</span><span class=p>.</span><span class=n>mu</span> <span class=o>&lt;&lt;</span> <span class=sc>&#39;\n&#39;</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-07-23</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/notes/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/%E6%95%B0%E5%AD%A6/>数学</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/matrix/ class=prev rel=prev title=矩阵乘法及应用><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>矩阵乘法及应用</a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.83.1">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2021 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://www.pigaunt.top target=_blank>PigAunt</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://www.mozilla.org/en-US/MPL/2.0/ target=_blank>Mozilla Public License 2.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/katex/katex.min.css><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/contrib/auto-render.min.js></script><script type=text/javascript src=/lib/katex/contrib/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:100},comment:{},data:{"id-1":"\n$$\n\\begin{cases}\nax' + by' = \\gcd(a, b) \\\\ \nbx + (a \\bmod b)y = \\gcd(b, a \\bmod b) \\\\\n\\gcd(a, b) = \\gcd(b, a \\bmod b)\n\\end{cases}\n$$\n","id-10":"\n$$\na^{im} \\equiv b \\times a^j \\pmod p\n$$\n","id-11":"\n$$\na^{x - 1} \\times \\frac a d \\equiv \\frac b d \\pmod{\\frac p d}\n$$\n","id-12":"\n$$\na^{x - k} \\times \\frac {a^k} {\\prod d} \\equiv \\frac {b} {\\prod d} \\pmod{\\frac {p} {\\prod d}}\n$$\n","id-13":"\n$$\nA^x = B\n$$\n","id-14":"\n$$\n{\\begin{bmatrix} f_{i - 1} \u0026 f_i \\end{bmatrix}} \\times {\\begin{bmatrix} 0 \u0026 1 \\cr 1 \u0026 1 \\end{bmatrix}}^x = {\\begin{bmatrix} f_{i - 1} \u0026 f_i \\end{bmatrix}}\n$$\n","id-15":"$i \\times \\mathrm{primes}_j$ ","id-16":"$g_{i \\times \\mathrm{primes}_j} = g_i \\times \\mathrm{primes}_j$","id-17":"$i \\times \\mathrm{primes}_j$ ","id-18":"$g_{i \\times \\mathrm{primes}_j} = \\mathrm{primes}_j$","id-19":"\n$$\n\\sum_{i = 1}^n h(n) = \\sum_{i = 1}^n \\sum_{d \\mid i} f(d) g(\\frac i d) \\\\\n= \\sum_{d = 1}^n g(d) \\sum_{i = 1}^{\\lfloor \\frac n d \\rfloor} f(i) \\\\ \n= g(1)s(n) + \\sum_{d = 2}^n g(d) s(\\lfloor \\frac n d \\rfloor)\n$$\n","id-2":"\n$$\nax' + by' = bx + (a \\bmod b)y \\\\\nax' + by' = bx + (a - b \\times \\lfloor{\\frac a b}\\rfloor)y \\\\ \nax' + by' = ay + b(x - \\lfloor{\\frac a b}\\rfloor y)\n$$\n","id-20":"\n$$\ng(1)s(n) = \\sum_{i = 1}^n h(i) - \\sum_{d = 2}^n g(d) s(\\lfloor \\frac n d \\rfloor)\n$$\n","id-3":"\n$$\n\\begin{cases}\nx' = y \\\\\ny' = x - \\lfloor{\\frac a b}\\rfloor y\n\\end{cases}\n$$\n","id-4":"\n$$\n\\begin{cases}\n    x \\equiv a_1 \\pmod{p_1} \\\\ \n    x \\equiv a_2 \\pmod{p_2} \\\\ \n    \\dots                   \\\\\n    x \\equiv a_n \\pmod{p_n}\n\\end{cases}\n$$\n","id-5":"\n$$\n\\begin{cases}\nx_i \\equiv 1 \\pmod{p_i} \\\\\nx_i \\equiv 0 \\pmod{p_j} (j \\neq i)\n\\end{cases}\n$$\n","id-6":"\n$$\n\\begin{cases}\n    x \\equiv a_1 \\pmod{p_1} \\\\\n    x \\equiv a_2 \\pmod{p_2}\n\\end{cases}\n$$\n","id-7":"\n$$\nx \\equiv k_1 p_1 + a_1 \\pmod{\\mathrm{lcm}(p_1, p_2)}\n$$\n","id-8":"\n$$\nx \\equiv a \\pmod p\n$$\n","id-9":"\n$$\na^{im - j} \\equiv b \\pmod p\n$$\n"},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>